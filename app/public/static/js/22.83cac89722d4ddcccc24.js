webpackJsonp([22],{"/Krs":function(t,e){},"6ogx":function(t,e){},c957:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("CzdK"),n={name:"merchantForm",data:function(){return{titleFont:this.edata?"编辑优惠券":"增加优惠券",autoUpload:!1,data:{},fileList:[],uploadFile:[],typeList:[],rules:{name:[{required:!0,message:"请输入优惠券名称",trigger:"blur"}],maxPrice:[{required:!0,message:"请输入优惠券金额",trigger:"blur"}],amount:[{required:!0,message:"请输入优惠券数量",trigger:"change"}],time:[{type:"array",required:!0,message:"请选择时间",trigger:"change"}]},time:[]}},props:["msg","shopId","edata"],created:function(){var t=this;this.edata&&(this.data=this.edata,this.time=[this.data.validityBeginAt,this.data.validityEndAt],Object(i.a)(this.data.icon,function(e){var a={url:e};t.fileList.push(a)}))},methods:{handleClose:function(){this.$emit("upList",1)},submitForm:function(){var t=this;this.uploadFile.length?Object(i.b)(this.uploadFile[0],function(e){t.data.icon=e,t.sendAjax()}):this.sendAjax()},sendAjax:function(){var t=this;if(this.data.maxPrice&&this.data.amount){var e=this.edata?"编辑":"添加",a=this.edata?"/biz/coupon/edit":"/biz/coupon/add";this.data.shopId=this.shopId,this.$xttp.post(a,this.data).then(function(a){a.errorCode||(t.$message({message:e+"优惠券成功",type:"success"}),t.$emit("upList",2))})}},httpRequest:function(t){this.uploadFile.push(t.file)},removeFile:function(t){this.uploadFile.splice(0,1)},changeTime:function(){this.time&&(this.data.validityBeginAt=this.time[0],this.data.validityEndAt=this.time[1])}}},l={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"c-uploadDialog",attrs:{title:t.titleFont,visible:t.msg,"before-close":t.handleClose},on:{"update:visible":function(e){t.msg=e}}},[a("el-form",{ref:"ruleForm",staticClass:"c-myForm",attrs:{model:t.data,"label-width":"120px",rules:t.rules}},[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{md:24,lg:10}},[a("el-row",[a("el-form-item",{attrs:{prop:"name",label:"优惠名称"}},[a("el-input",{attrs:{"auto-complete":"false",size:"small"},model:{value:t.data.name,callback:function(e){t.$set(t.data,"name",e)},expression:"data.name "}})],1),t._v(" "),a("el-form-item",{attrs:{prop:"maxPrice",label:"优惠金额"}},[a("el-input",{attrs:{"auto-complete":"false",type:"number",min:"1",size:"small"},model:{value:t.data.maxPrice,callback:function(e){t.$set(t.data,"maxPrice",e)},expression:"data.maxPrice"}})],1)],1)],1),t._v(" "),a("el-col",{attrs:{md:24,lg:14}},[a("el-upload",{staticClass:"avatar-uploader",staticStyle:{"margin-left":"10px"},attrs:{action:"","file-list":t.fileList,"list-type":"picture-card","http-request":t.httpRequest,"on-remove":t.removeFile,limit:1}},[a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"发行数量",prop:"amount"}},[a("el-input",{attrs:{type:"number",min:"1",size:"small"},model:{value:t.data.amount,callback:function(e){t.$set(t.data,"amount",e)},expression:"data.amount"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"有效期限",prop:"validityBeginAt"}},[a("el-date-picker",{attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",clearable:"","value-format":"timestamp"},on:{change:t.changeTime},model:{value:t.time,callback:function(e){t.time=e},expression:"time"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"领取限制",prop:"couponLimit"}},[a("el-input",{attrs:{size:"small"},model:{value:t.data.couponLimit,callback:function(e){t.$set(t.data,"couponLimit",e)},expression:"data.couponLimit"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"使用须知",prop:"prompt"}},[a("el-input",{attrs:{size:"small"},model:{value:t.data.prompt,callback:function(e){t.$set(t.data,"prompt",e)},expression:"data.prompt"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"校验密令",prop:"validCode"}},[a("el-input",{attrs:{size:"small"},model:{value:t.data.validCode,callback:function(e){t.$set(t.data,"validCode",e)},expression:"data.validCode"}})],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.submitForm("ruleForm")}}},[t._v("保存")])],1)],1)},staticRenderFns:[]};var s={name:"couponList",data:function(){return{isSou:!1,tableData:[],navDetailData:[{id:0,name:"首页",router:"/home"},{id:1,name:"商圈管理",router:"/home/nav/businessManage/merchant"},{id:2,name:"周边商圈",router:"/home/nav/businessManage/merchant"},{id:3,name:"优惠券管理"}],formInline:{name:""},currentPage:1,pageSize:10,loading:!1,isShow:!1,total:0,notice:null,visible2:!1,visible3:!1,ValidId:null,isIssue:!1,delData:null,statusList:[],shopId:this.$route.query.id}},components:{formPage:a("VU/8")(n,l,!1,function(t){a("/Krs")},"data-v-f5766076",null).exports},methods:{onSubmit:function(){this.notice=null,this.isShow=!this.isShow},handleCurrentChange:function(t){this.currentPage!==t&&this.sendAjax(t)},editHandle:function(t){this.isShow=!0,this.notice=t},delHandle:function(t){this.visible2=!0,this.delData=t},validHandle:function(t){this.isIssue=0==t.validStatus,this.visible3=!0,this.ValidId=t.id},confirmDel:function(){var t=this;this.delData.id&&this.$xttp.get("/biz/coupon/"+this.delData.id+"/delete").then(function(e){e.errorCode||(t.visible2=!1,t.delData=null,t.$message({message:"删除优惠券成功",type:"success"}),t.find())})},confirmValid:function(){var t=this,e=this.isIssue?"发布":"撤下",a=this.isIssue?1:0;this.ValidId&&this.$xttp.post("/biz/coupon/valid",{validStatus:a,id:this.ValidId}).then(function(a){a.errorCode||(t.visible3=!1,t.ValidId=null,t.isIssue=!t.isIssue,t.$message({message:e+"优惠券成功",type:"success"}),t.find())})},change:function(t){1==t?this.isShow=!1:2!=t&&3!=t||(this.sendAjax(),this.isShow=!1)},selStatus:function(){},find:function(){this.sendAjax(1)},sendAjax:function(t){var e=this,a={page:t||this.$route.query.page||1,shopId:this.$route.query.id};this.formInline.name?a.name=this.formInline.name:delete a.name,this.loading=!0,this.$xttp.post("/biz/coupon/page",a).then(function(t){t.errorCode||(e.tableData=t.data.records,e.currentPage=t.data.currentPage,e.total=t.data.total),e.loading=!1}).catch(function(t){e.loading=!1})}},created:function(){this.sendAjax()},mounted:function(){}},o={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-main",[a("div",[a("ul",{staticClass:"c-navDetail clear"},t._l(t.navDetailData,function(e,i){return a("li",{key:i},[t._v(t._s(e.name)+" "),i!==t.navDetailData.length-1?a("span",[t._v(" > ")]):t._e()])})),t._v(" "),a("div",{staticClass:"c-search"},[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:t.formInline}},[a("el-form-item",[a("el-input",{attrs:{placeholder:"优惠券名称",clearable:""},model:{value:t.formInline.name,callback:function(e){t.$set(t.formInline,"name",e)},expression:"formInline.name"}})],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.find}},[a("i",{staticClass:"iconfont icon-sousuo"},[t._v(" ")]),t._v("查询")])],1)],1),t._v(" "),a("el-button",{staticClass:"c-addBtn",attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("新增优惠券")])],1)]),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"c-table",staticStyle:{width:"100%"},attrs:{data:t.tableData,"element-loading-text":"加载中...",border:"","highlight-current-row":""}},[a("el-table-column",{attrs:{label:"序号",width:"60",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s((t.currentPage-1)*t.pageSize+e.$index+1))]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"优惠券","min-width":"100",align:"center","show-overflow-tooltip":!0},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.name))]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"优惠金额","min-width":"60",align:"center","show-overflow-tooltip":!0},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.maxPrice))]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"总数","min-width":"60",align:"center","show-overflow-tooltip":!0},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.amount))]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"生效时间","min-width":"70",align:"center","show-overflow-tooltip":!0},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("time")(e.row.validityBeginAt,"yyyy-MM-dd")))]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"失效时间","min-width":"70",align:"center","show-overflow-tooltip":!0},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("time")(e.row.validityEndAt,"yyyy-MM-dd")))]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"状态","min-width":"60",align:"center","show-overflow-tooltip":!0},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("validStatus")(e.row.validStatus)))]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"已领取数量","min-width":"60",align:"center","show-overflow-tooltip":!0},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.receiveNum))]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"已使用数量","min-width":"60",align:"center","show-overflow-tooltip":!0},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.useNum||"无"))]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",fixed:"right",label:"操作",width:"220"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"warning",size:"small"},on:{click:function(a){t.editHandle(e.row)}}},[t._v("编辑")]),t._v(" "),0==e.row.validStatus?a("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(a){t.delHandle(e.row)}}},[t._v("删除")]):t._e(),t._v(" "),a("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(a){t.validHandle(e.row)}}},[t._v(t._s(t.isIssue?"发布":"撤下"))])]}}])})],1),t._v(" "),a("div",{staticClass:"c-block"},[a("el-pagination",{attrs:{"current-page":t.currentPage,"page-size":10,layout:"total, prev, pager, next, jumper",total:t.total},on:{"current-change":t.handleCurrentChange}})],1),t._v(" "),a("transition",{attrs:{name:"fade1"}},[t.isShow?a("formPage",{attrs:{msg:t.isShow,shopId:t.shopId,edata:t.notice},on:{upList:t.change}}):t._e()],1),t._v(" "),a("el-dialog",{attrs:{title:"温馨提示",visible:t.visible2},on:{"update:visible":function(e){t.visible2=e}}},[a("p",[t._v("请问您是否确定删除这条数据吗？")]),t._v(" "),a("div",{staticStyle:{"text-align":"right",margin:"0"}},[a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(e){t.visible2=!1}}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.confirmDel}},[t._v("确定")])],1)]),t._v(" "),a("el-dialog",{attrs:{title:"温馨提示",visible:t.visible3},on:{"update:visible":function(e){t.visible3=e}}},[a("p",[t._v("请问您是否确定"+t._s(t.isIssue?"发布":"撤下")+"优惠券？")]),t._v(" "),a("div",{staticStyle:{"text-align":"right",margin:"0"}},[a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(e){t.visible3=!1}}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.confirmValid}},[t._v("确定")])],1)])],1)},staticRenderFns:[]};var r=a("VU/8")(s,o,!1,function(t){a("6ogx")},"data-v-4d337bc5",null);e.default=r.exports}});
//# sourceMappingURL=22.83cac89722d4ddcccc24.js.map