webpackJsonp([18],{"7JvE":function(t,e){},ZFhX:function(t,e){},qTNo:function(t,e){},zdGx:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("2hfY"),l={data:function(){return{communityList:[],form:{faultAddress:"",faultType:"2",faultContent:"",contact:"",userName:"",faultItem:"",buildingId:"",communityId:this.$store.getters.communityId},rules:{faultItem:[{required:!0,message:"请输入故障类型",trigger:"blur"}],faultAddress:[{required:!0,message:"请输入故障地址",trigger:"blur"}],faultContent:[{required:!0,message:"请描述故障",trigger:"blur"}],userName:[{required:!0,message:"请输入姓名",trigger:"blur"}],contact:[{type:"number",required:!0,message:"请填写联系方式",trigger:"blur"}]}}},methods:{submitForm:function(t){var e=this;this.$refs[t].validate(function(t){if(!t)return!1;e.postData()})},handleClose:function(){this.$emit("upsee",!1)},postData:function(){var t=this;this.$xttp.post("property/fault/addFault",this.form).then(function(e){0===e.errorCode?(t.$message({message:"新增成功",type:"success"}),t.handleClose(),t.$emit("addSuccess")):t.$message({message:e.data.errorMsg,type:"error"})}).catch(function(t){console.log(t)})}},props:["msg"],created:function(){}},s={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:"新增故障",visible:t.msg,"before-close":t.handleClose},on:{"update:visible":function(e){t.msg=e}}},[a("el-form",{ref:"ruleForm",attrs:{model:t.form,rules:t.rules,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"故障类型",prop:"faultItem",required:""}},[a("el-select",{attrs:{placeholder:"故障类型"},model:{value:t.form.faultItem,callback:function(e){t.$set(t.form,"faultItem",e)},expression:"form.faultItem"}},[a("el-option",{attrs:{label:"公共-消防安防",value:"3"}}),t._v(" "),a("el-option",{attrs:{label:"公共-门禁",value:"11"}}),t._v(" "),a("el-option",{attrs:{label:"公共-其他",value:"99"}})],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"故障地址","label-width":"120px",prop:"faultAddress",required:""}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:t.form.faultAddress,callback:function(e){t.$set(t.form,"faultAddress",e)},expression:"form.faultAddress"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"故障描述",prop:"faultContent",required:""}},[a("el-input",{attrs:{type:"textarea",rows:5},model:{value:t.form.faultContent,callback:function(e){t.$set(t.form,"faultContent",e)},expression:"form.faultContent"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"申报人","label-width":"120px",prop:"userName",required:""}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:t.form.userName,callback:function(e){t.$set(t.form,"userName",e)},expression:"form.userName"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"联系方式","label-width":"120px",prop:"contact",required:""}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:t.form.contact,callback:function(e){t.$set(t.form,"contact",t._n(e))},expression:"form.contact"}})],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.handleClose}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.submitForm("ruleForm")}}},[t._v("确 定")])],1)],1)},staticRenderFns:[]};var r=a("VU/8")(l,s,!1,function(t){a("ZFhX")},"data-v-09a278c2",null).exports,n=a("CzdK"),o={data:function(){return{time:"",faultType:"",faultStatus:"",acceptTime:"",rejectTime:"",uri:""}},methods:{handleClose:function(){this.$emit("upsee",!1)},getTime:function(t,e){return null==t?"/":i.a.timestampToFormat(t,e)},getData:function(){var t=this,e=this.data;if(this.time=this.getTime(e.playTime,"yyyy-MM-dd HH:mm"),this.acceptTime=this.getTime(e.acceptTime,"yyyy-MM-dd HH:mm"),this.rejectTime=this.getTime(e.rejectTime,"yyyy-MM-dd HH:mm"),this.faultType=1==e.faultType?"住户":2==e.faultType?"公共":"其它",this.faultStatus=0==e.faultStatus?"已取消":1==e.faultStatus?"已提交":2==e.faultStatus?"已受理":3==e.faultStatus?"已指派":4==e.faultStatus?"已完成":"已驳回",!e.faultAccessory)return!1;e.faultAccessory.forEach(function(e){Object(n.a)(e,function(e){t.uri=e})})}},props:["msg","data"],created:function(){this.getData()}},u={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:"故障详情",visible:t.msg,"before-close":t.handleClose},on:{"update:visible":function(e){t.msg=e}}},[a("el-form",{attrs:{model:t.data,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"申报人名","label-width":"120px",prop:"userName",required:""}},[a("span",[t._v(t._s(t.data.userName))])]),t._v(" "),a("el-form-item",{attrs:{label:"联系方式","label-width":"120px",required:""}},[a("span",[t._v(t._s(t.data.contact))])]),t._v(" "),a("el-form-item",{attrs:{label:"申报时间","label-width":"120px",required:""}},[a("span",[t._v(t._s(t.time))])]),t._v(" "),a("el-form-item",{attrs:{label:"故障类型","label-width":"120px",required:""}},[a("span",[t._v(t._s(t.faultType))])]),t._v(" "),a("el-form-item",{attrs:{label:"故障地址","label-width":"120px",required:""}},[a("span",[t._v(t._s(t.data.faultAddress))])]),t._v(" "),a("el-form-item",{attrs:{label:"故障描述","label-width":"120px",required:""}},[a("span",[t._v(t._s(t.data.faultContent))]),t._v(" "),t.uri?a("div",{staticClass:"c-image"},[t._v("图片："),a("img",{attrs:{src:t.uri}})]):t._e()]),t._v(" "),a("el-form-item",{attrs:{label:"故障状态","label-width":"120px",required:""}},[a("span",[t._v(t._s(t.faultStatus))])]),t._v(" "),"已指派"===t.faultStatus||"已完成"===t.faultStatus||"待评价"===t.faultStatus?[a("el-form-item",{attrs:{label:"维修人员","label-width":"120px",required:""}},[a("span",[t._v(t._s(t.data.repairName))])]),t._v(" "),a("el-form-item",{attrs:{label:"联系方式","label-width":"120px",required:""}},[a("span",[t._v(t._s(t.data.repairContact))])]),t._v(" "),a("el-form-item",{attrs:{label:"受理时间","label-width":"120px",required:""}},[a("span",[t._v(t._s(t.acceptTime))])])]:t._e(),t._v(" "),"已驳回"===t.faultStatus?[a("el-form-item",{attrs:{label:"驳回理由","label-width":"120px",required:""}},[a("span",[t._v(t._s(t.data.rejectReason))])]),t._v(" "),a("el-form-item",{attrs:{label:"驳回时间","label-width":"120px",required:""}},[a("span",[t._v(t._s(t.rejectTime))])])]:t._e(),t._v(" "),"待评价"===t.faultStatus?[a("el-form-item",{attrs:{label:"完成时间","label-width":"120px",required:""}},[a("span",[t._v(t._s(t.data.finishTime))])])]:t._e(),t._v(" "),"已完成"===t.faultStatus?[a("el-form-item",{attrs:{label:"完成时间","label-width":"120px",required:""}},[a("span",[t._v(t._s(t.data.finishTime))])]),t._v(" "),a("el-form-item",{attrs:{label:"评价等级","label-width":"120px",required:""}},[a("span",[t._v(t._s(t.data.evaluationGrade))])]),t._v(" "),a("el-form-item",{attrs:{label:"服务评价","label-width":"120px",required:""}},[a("span",[t._v(t._s(t.data.evaluation))])])]:t._e()],2),t._v(" "),"已提交"===t.faultStatus?a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"}):t._e()],1)},staticRenderFns:[]};var c={name:"fault",components:{AddPage:r,SeePage:a("VU/8")(o,u,!1,function(t){a("qTNo")},"data-v-a96b74b4",null).exports},data:function(){return{value6:"",value1:"",options:[{value:"0",label:"已取消"},{value:"1",label:"已提交"},{value:"2",label:"已受理"},{value:"3",label:"已指派"},{value:"4",label:"已完成"},{value:"-1",label:"已驳回"}],navDetailData:[{id:0,name:"物业服务"},{id:1,name:"故障报修"},{id:2,name:"故障管理"}],loading:!1,tableData:[],pageSize:10,total:0,currentPage:1,formVisible:!1,previewVisible:!1,previewNoticeInfo:null,input:"",q_input:null,see:!1,seeData:null,showAssign:!1,assignData:null,visible2:!1,delData:null,addSee:!1,visible3:!1,confirmData:"",visible1:!1,confirmAssign:"",confirmRejectData:"",reason:"",repairData:"",value:""}},methods:{query:function(){this.q_input=this.input,1!==this.currentPage?this.currentPage=1:this.getTableList(1)},addChange:function(t){this.addSee=!1},seeChange:function(t){this.see=!1},changeStatus:function(){this.query(),this.tableData=[]},getPublishStatusName:function(t){return{"-1":"已驳回",0:"已取消",1:"已提交",2:"已受理",3:"已指派",4:"已完成"}[t]},getfaultItem:function(t){return{1:"水电煤气",2:"房屋结构",3:"消防安防",10:"电梯",11:"门禁",99:"其它"}[t]},handleClick:function(t){var e=this,a="property/fault/"+t.id+"/detail";this.$xttp.get(a).then(function(t){if(0===t.errorCode)return e.repairName=t.data.repairName,e.seeData=t.data,e.see=!0,e.seeData}).catch(function(){e.loading=!1})},workMan:function(){var t=this,e="user/property/"+this.$store.getters.communityId+"/user-list?postCode=SERVICEMAN";this.$xttp.get(e).then(function(e){0===e.errorCode&&(t.loading=!1,t.repairData=e.data)}).catch(function(){t.loading=!1})},assignHandle:function(t){this.visible1=!0,this.assignData=t},assignStaff:function(t){if(!this.value)return this.visible1=!1,this.$message({message:"请选择维修人员",type:"warning"}),!1;this.visible1=!1,this.assignData.faultStatus=3,this.assign(this.assignData)},assign:function(t){var e=this,a={};a.id=this.assignData.id,a.repairId=this.value,this.$xttp.post("property/fault/allocation",a).then(function(t){0===t.errorCode&&(console.log("res",t),e.loading=!1,e.$message({message:"分派成功",type:"success"}))}).catch(function(){e.loading=!1})},reject:function(t){this.visible3=!0,this.reason="",this.confirmRejectData=t},confirmReject:function(){this.visible3=!1,this.see=!1,this.$message({message:"驳回成功",type:"success"}),this.confirmRejectData.faultStatus=-1,this.confirmRejectData.rejectReason=this.reason,console.log("驳回",this.confirmRejectData),this.rejectAccept(this.confirmRejectData)},rejectAccept:function(t){var e=this;this.$xttp.post("property/fault/editFaultStatus",{id:t.id,faultStatus:t.faultStatus,rejectReason:t.rejectReason}).then(function(t){0===t.errorCode&&(e.loading=!1,e.$message({message:"驳回申报成功",type:"success"}))}).catch(function(){e.loading=!1})},receive:function(t){this.visible2=!0,this.confirmData=t},confirm:function(t){this.visible2=!1,this.see=!1,this.$message({message:"受理成功",type:"success"}),this.confirmData.faultStatus=2,this.faultAccept(this.confirmData)},faultAccept:function(t){var e=this;this.$xttp.post("property/fault/editFaultStatus",{id:t.id,faultStatus:t.faultStatus}).then(function(t){0===t.errorCode&&(e.loading=!1)}).catch(function(){e.loading=!1,e.$message.error("故障受理失败")})},publish:function(t){var e=this;this.loading=!0;var a="property/notice/"+t.id+"/publish";this.$xttp.get(a).then(function(a){e.loading=!1,0===a.errorCode&&(t.publishStatus=1)}).catch(function(){e.loading=!1})},add:function(){this.addSee=!0},getTableList:function(t){var e=this,a={};this.q_input&&(a.userName=this.q_input),this.value1&&(a.faultStatus=this.value1);var i=this.$store.getters.communityId;a.communityId=i;var l="property/fault/queryFaultPage?page="+t+"&size="+this.pageSize;if(this.loading=!0,this.value6){var s=new Date(this.value6[0]),r=new Date(this.value6[1]);a.playTimeBegin=s.getFullYear()+"-"+(s.getMonth()<10?"0":"")+(s.getMonth()+1)+"-"+(s.getDate()<10?"0":"")+s.getDate(),a.playTimeEnd=r.getFullYear()+"-"+(r.getMonth()<10?"0":"")+(r.getMonth()+1)+"-"+(r.getDate()<10?"0":"")+r.getDate()}this.$xttp.post(l,a).then(function(t){0===t.errorCode&&(e.tableData=t.data.records,e.total=t.data.total,e.loading=!1,e.$router.push({path:e.$route.path,query:{page:nPage}}))}).catch(function(){e.loading=!1})},getTime:function(t,e){return null==t?"/":i.a.timestampToFormat(t,e)}},created:function(){this.workMan(),this.getTableList(1)}},f={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-container",[a("el-main",[a("ul",{staticClass:"c-navDetail clear"},t._l(t.navDetailData,function(e,i){return a("li",{key:i},[t._v(t._s(e.name)+" "),i!==t.navDetailData.length-1?a("span",[t._v(" > ")]):t._e()])})),t._v(" "),a("div",{staticClass:"c-notice-container"},[a("div",{staticClass:"c-search"},[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0}},[a("el-select",{attrs:{placeholder:"全部状态",clearable:""},on:{change:t.changeStatus},model:{value:t.value1,callback:function(e){t.value1=e},expression:"value1"}},t._l(t.options,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),t._v(" "),a("el-date-picker",{attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",clearable:""},on:{change:t.changeStatus},model:{value:t.value6,callback:function(e){t.value6=e},expression:"value6"}}),t._v(" "),a("el-form-item",{attrs:{label:""}},[a("el-input",{attrs:{placeholder:"申报人"},model:{value:t.input,callback:function(e){t.input="string"==typeof e?e.trim():e},expression:"input"}})],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.query}},[t._v("查询")])],1),t._v(" "),a("el-form-item",{staticStyle:{float:"right"}},[a("el-button",{staticClass:"c-addBtn",attrs:{type:"primary"},on:{click:t.add}},[t._v("新增故障")])],1)],1)],1),t._v(" "),a("div",{staticClass:"c-list"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.tableData,align:"center"}},[a("el-table-column",{attrs:{prop:"no",label:"编号",width:"80",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s((t.currentPage-1)*t.pageSize+e.$index+1))]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"faultType",label:"故障类型","min-width":"180",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(1===e.row.faultType?"住户":2===e.row.faultType?"公共":"其它")+"-"+t._s(t.getfaultItem(e.row.faultItem)))]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"userName",label:"申报人",width:"120",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"identity",label:"身份",width:"80",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(1===e.row.identity?"住户":2===e.row.faultType?"物业":"其它"))]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"contact",label:"联系方式",width:"120",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"playTime",label:"申报时间",width:"160",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t.getTime(e.row.playTime,"yyyy-MM-dd HH:mm")))]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"faultItem",label:"故障描述",width:"120",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t.getfaultItem(e.row.faultItem)))]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"faultStatus",label:"故障状态",width:"80",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t.getPublishStatusName(e.row.faultStatus)))]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"",label:"操作",width:"300",fixed:"right",align:"left"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){t.handleClick(e.row)}}},[t._v("查看详情")]),t._v(" "),1===e.row.faultStatus?[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){t.receive(e.row)}}},[t._v("受理故障")]),t._v(" "),a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(a){t.reject(e.row)}}},[t._v("驳回申请")])]:t._e(),t._v(" "),2===e.row.faultStatus?[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){t.assignHandle(e.row)}}},[t._v("指派人员")])]:t._e()]}}])})],1)],1),t._v(" "),a("div",{staticClass:"c-pagination"},[a("el-pagination",{attrs:{layout:"total, prev, pager, next, jumper",total:t.total,"page-size":t.pageSize,"current-page":t.currentPage},on:{"current-change":t.getTableList,"update:currentPage":function(e){t.currentPage=e}}})],1)]),t._v(" "),a("transition",{attrs:{name:"fade1"}},[t.addSee?a("AddPage",{attrs:{msg:t.addSee},on:{upsee:t.addChange,addSuccess:t.query}}):t._e()],1),t._v(" "),a("transition",{attrs:{name:"fade"}},[t.see?a("SeePage",{attrs:{msg:t.see,data:t.seeData},on:{upsee:t.seeChange,accept:function(e){t.receive(t.seeData)},del:function(e){t.reject(t.seeData)}}}):t._e()],1),t._v(" "),a("el-dialog",{attrs:{title:"温馨提示",visible:t.visible2},on:{"update:visible":function(e){t.visible2=e}}},[a("p",[t._v("请问您确定提交吗？")]),t._v(" "),a("div",{staticStyle:{"text-align":"right",margin:"0"}},[a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(e){t.visible2=!1}}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.confirm}},[t._v("确定")])],1)]),t._v(" "),a("el-dialog",{attrs:{title:"温馨提示",visible:t.visible3},on:{"update:visible":function(e){t.visible3=e}}},[a("p",[t._v("驳回理由 :")]),t._v(" "),a("el-input",{attrs:{type:"textarea",rows:5},model:{value:t.reason,callback:function(e){t.reason="string"==typeof e?e.trim():e},expression:"reason"}}),t._v(" "),a("div",{staticStyle:{"text-align":"right",margin:"0"}},[a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(e){t.visible3=!1}}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.confirmReject}},[t._v("确定")])],1)],1),t._v(" "),a("el-dialog",{attrs:{title:"温馨提示",visible:t.visible1},on:{"update:visible":function(e){t.visible1=e}}},[a("span",[t._v("指派员工 :")]),t._v(" "),a("el-select",{attrs:{placeholder:"请选择维修人员",clearable:""},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}},t._l(t.repairData,function(t){return a("el-option",{key:t.userId,attrs:{label:t.userName,value:t.userId}})})),t._v(" "),a("div",{staticStyle:{"text-align":"right",margin:"0"}},[a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(e){t.visible1=!1}}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.assignStaff}},[t._v("确定")])],1)],1)],1)],1)},staticRenderFns:[]};var d=a("VU/8")(c,f,!1,function(t){a("7JvE")},"data-v-1ff95b6e",null);e.default=d.exports}});
//# sourceMappingURL=18.7d6ccb2f4e67429ac889.js.map