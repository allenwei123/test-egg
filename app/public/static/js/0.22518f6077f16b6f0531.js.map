{"version":3,"sources":["webpack:///./node_modules/core-js/library/fn/object/define-property.js","webpack:///./node_modules/babel-runtime/core-js/object/define-property.js","webpack:///./src/biz/community.js","webpack:///./src/utils/oss.js","webpack:///./node_modules/babel-runtime/helpers/defineProperty.js","webpack:///./node_modules/core-js/library/modules/es6.object.define-property.js"],"names":["__webpack_require__","$Object","Object","module","exports","it","key","desc","defineProperty","default","__esModule","toName","arr","arguments","id","i","length","item","name","send","file","success","info","window","localStorage","getItem","JSON","parse","now","Date","expire","data","console","log","bucket","fileKey","__WEBPACK_IMPORTED_MODULE_2__store__","getters","uid","substr","lastIndexOf","request","FormData","append","accessid","policy","signature","req","createData","__WEBPACK_IMPORTED_MODULE_1__request__","post","host","then","res","status","get","errorCode","replace","setItem","__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify___default","getUri","expiration","getTime","client","OSS","Wrapper","region","accessKeyId","accessKeySecret","stsToken","securityToken","secure","signatureUrl","obj","_defineProperty","_defineProperty2","value","enumerable","configurable","writable","$export","S","F","f"],"mappings":"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","file":"static/js/0.22518f6077f16b6f0531.js","sourcesContent":["require('../../modules/es6.object.define-property');\nvar $Object = require('../../modules/_core').Object;\nmodule.exports = function defineProperty(it, key, desc) {\n  return $Object.defineProperty(it, key, desc);\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/library/fn/object/define-property.js\n// module id = 9bBU\n// module chunks = 0","module.exports = { \"default\": require(\"core-js/library/fn/object/define-property\"), __esModule: true };\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/babel-runtime/core-js/object/define-property.js\n// module id = C4MV\n// module chunks = 0","import http from '../utils/request';\r\n\r\nlet communityId = function (name) {\r\n    let obj = name ? {name} : {};\r\n    return http.post('/community/list', obj).then(res => {\r\n        if(!res.errorCode) {\r\n            return res.data;\r\n        }else {\r\n            return {msg: '请联系开发人员'}\r\n        }\r\n    }).catch(err => {\r\n        return {code:1,msg:'温馨提示：网络有问题!!'}\r\n    })\r\n}\r\nlet toName = function () {\r\n    let arr = arguments[0];\r\n    let id = arguments[1];\r\n    if(!id)return;\r\n    for (let i = 0; i< arr.length;i++) {\r\n        var item = arr[i];\r\n        if(item.id == id) {\r\n            return item.name;\r\n        }\r\n    }\r\n}\r\nexport {\r\n    communityId,\r\n    toName\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/biz/community.js","import http from './request';\nimport store from '@/store';\n\nfunction createData(info, file) {\n  console.log(info.bucket+\"======\")\n    let fileKey = 'web1' + store.getters.uid +'_'+ info.bucket+'_'+ + Date.parse(new Date()) + file.name.substr(file.name.lastIndexOf('.'));\n    // 组装发送数据\n\n    var request = new FormData();\n    request.append(\"OSSAccessKeyId\", info.accessid);//Bucket 拥有者的Access Key Id。\n    request.append(\"policy\", info.policy);//policy规定了请求的表单域的合法性\n    request.append(\"signature\", info.signature);//根据Access Key Secret和policy计算的签名信息，OSS验证该签名信息从而验证该Post请求的合法性\n    //---以上都是阿里的认证策略\n    request.append(\"key\", fileKey);//文件名字，可设置路径\n    request.append(\"success_action_status\", '200');// 让服务端返回200,不然，默认会返回204\n    request.append('file', file);//需要上传的文件 file\n    request.append('Filename', fileKey);\n    return {\n        key: fileKey,\n        req: request\n    }\n}\n\n\nexport function send(file, success) {\n    let info = window.localStorage.getItem('uploadInfo') == 'undefined' ? null : JSON.parse(window.localStorage.getItem('uploadInfo'));\n    let now = Date.parse(new Date()) / 1000;\n\n    if (!info || info.expire < now + 3) {\n        http.get(\"/oss/bit-smcm-img/policy\")\n            .then(res => {\n                if (!res.errorCode) {\n                  console.log(res.data);\n                  let host = res.data.host;\n                  host = host.replace('http:','https:');\n                  res.data.host = host;\n                  console.log(res.data);\n                    window.localStorage.setItem('uploadInfo', JSON.stringify(res.data));\n                    send(file, success);\n                }\n            })\n    } else {\n        let data = createData(info, file);\n        // return data;\n        return http.post(info.host, data.req).then(res => {\n            if (res.status === 200) {\n                if (success) {\n                    success(data.key);\n                }\n            }\n        })\n    }\n}\n\n\nexport function getUri(key,success) {\n    let info = window.localStorage.getItem('downloadInfo') == 'undefined' ? null : JSON.parse(window.localStorage.getItem('downloadInfo'));\n    let now = Date.parse(new Date()) / 1000;\n    let expire = 88888888888888888888888888888;\n    if(info) {\n        expire = new Date(info.expiration).getTime()/1000;\n    }\n    if (!info || expire < now + 3) {\n        http.get(\"/oss/sts-token/read-only\")\n            .then(res => {\n                if (!res.errorCode) {\n                    window.localStorage.setItem('downloadInfo', JSON.stringify(res.data));\n                    getUri(key,success);\n                }\n            })\n    }else {\n        var client = new OSS.Wrapper({\n            region: 'oss-cn-beijing',\n            accessKeyId: info.accessKeyId,//info.accessKeyId\n            accessKeySecret: info.accessKeySecret,//info.accessKeySecret\n            stsToken: info.securityToken,//info.securityToken\n            // bucket: info.bucket || 'bit-test'//info.bucket\n            bucket: info.bucket || 'bit-smcm-img',//info.bucket\n            secure: true  //啓動https\n        });\n        if(success) {\n            success(client.signatureUrl(key));\n        }\n    }\n}\n\n\n//选自https://www.cnblogs.com/mottled/p/6979536.html\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils/oss.js","\"use strict\";\n\nexports.__esModule = true;\n\nvar _defineProperty = require(\"../core-js/object/define-property\");\n\nvar _defineProperty2 = _interopRequireDefault(_defineProperty);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nexports.default = function (obj, key, value) {\n  if (key in obj) {\n    (0, _defineProperty2.default)(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/babel-runtime/helpers/defineProperty.js\n// module id = bOdI\n// module chunks = 0","var $export = require('./_export');\n// 19.1.2.4 / 15.2.3.6 Object.defineProperty(O, P, Attributes)\n$export($export.S + $export.F * !require('./_descriptors'), 'Object', { defineProperty: require('./_object-dp').f });\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/library/modules/es6.object.define-property.js\n// module id = mClu\n// module chunks = 0"],"sourceRoot":""}