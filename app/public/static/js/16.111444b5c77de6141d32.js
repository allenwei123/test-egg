webpackJsonp([16],{RXoI:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});a("mtWM");var l=a("2hfY"),n={data:function(){return{form:{value1:"",value2:"",value3:"",keyNo:""},value:"",makeAt:"",options:[{value:"2",label:"蓝牙卡"},{value:"4",label:"IC卡"}],options2:[{value:"MANAGER",label:"物业管理员"},{value:"SECURITY",label:"保安"},{value:"CLEANER",label:"保洁"},{value:"SERVICEMAN",label:"维修工"},{value:"SUPPORTSTAFF",label:"客服人员"}],options3:"",rules:{keyNo:[{required:!0,message:"请输入卡号",trigger:"blur"}],value1:[{required:!0,message:"请选择卡类型",trigger:"blur"}],value2:[{required:!0,message:"请输入角色",trigger:"blur"}],value3:[{required:!0,message:"请选择员工",trigger:"blur"}]},userToRoomId:""}},methods:{submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;t.postData()})},role:function(){var e=this,t="user/property/"+this.$store.getters.communityId+"/user-list?postCode="+this.form.value2;this.$xttp.get(t).then(function(t){0===t.errorCode&&(e.loading=!1,e.options3=t.data)}).catch(function(){e.loading=!1})},handleClose:function(){this.$emit("change")},getTime:function(e,t){return null==e?"/":l.a.timestampToFormat(e,t)},postData:function(){var e=this,t={communityId:this.$store.getters.communityId,userId:"5aa733d4e4b0274d66f17e9c"};this.$xttp.post("room/query-by-user",t).then(function(t){if(0===t.errorCode){e.loading=!1,e.userToRoomId=t.data[0].id;var a={keyType:e.form.value1,rooms:["5a82b08ab06c97e0cd6c1182"],processTime:214748368,keyNo:e.form.keyNo,useraTimes:0};if(12!==a.keyNo.length)return void e.$message({message:"请输入12位卡号",type:"warning"});e.$xttp.post("user/card/add",a).then(function(t){0===t.errorCode?(e.$message({message:"新增成功",type:"success"}),e.handleClose(),e.$emit("addSuccess")):e.$message({message:t.data.errorMsg,type:"error"})}).catch(function(){e.loading=!1})}}).catch(function(){e.loading=!1})}},created:function(){},props:["msg"]},s={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:"新增卡片",visible:e.msg,"before-close":e.handleClose},on:{"update:visible":function(t){e.msg=t}}},[a("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"卡号",prop:"keyNo",required:""}},[a("el-input",{attrs:{"auto-complete":"off",placeholder:"请输入12位卡号"},model:{value:e.form.keyNo,callback:function(t){e.$set(e.form,"keyNo",t)},expression:"form.keyNo"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"卡类型","label-width":"120px",prop:"value1",required:""}},[a("el-select",{attrs:{clearable:""},model:{value:e.form.value1,callback:function(t){e.$set(e.form,"value1",t)},expression:"form.value1"}},e._l(e.options,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"角色","label-width":"120px",prop:"value2",required:""}},[a("el-select",{attrs:{clearable:""},on:{change:e.role},model:{value:e.form.value2,callback:function(t){e.$set(e.form,"value2",t)},expression:"form.value2"}},e._l(e.options2,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"所属员工","label-width":"120px",prop:"value3",required:""}},[a("el-select",{attrs:{clearable:""},model:{value:e.form.value3,callback:function(t){e.$set(e.form,"value3",t)},expression:"form.value3"}},e._l(e.options3,function(e){return a("el-option",{key:e.userId,attrs:{label:e.userName,value:e.userId}})}))],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.handleClose}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submitForm("ruleForm")}}},[e._v("确 定")])],1)],1)},staticRenderFns:[]};var o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:"卡片详情",visible:e.msg,"before-close":e.handleClose},on:{"update:visible":function(t){e.msg=t}}},[a("ul",[a("li",{staticClass:"c-list"},[a("span",{staticClass:"c-label"},[e._v("卡编号:")]),e._v(" "),a("span",{staticClass:"c-content"},[e._v(" "+e._s(e.data.keyNo)+" ")])]),e._v(" "),a("li",{staticClass:"c-list"},[a("span",{staticClass:"c-label"},[e._v("用户名:")]),e._v(" "),a("span",{staticClass:"c-content"},[e._v(" "+e._s(e.data.name)+" ")])]),e._v(" "),a("li",{staticClass:"c-list"},[a("span",{staticClass:"c-label"},[e._v("卡片类型:")]),e._v(" "),a("span",{staticClass:"c-content"},[e._v(" "+e._s(e._f("card")(e.data.keyType))+" ")])]),e._v(" "),a("li",{staticClass:"c-list"},[a("span",{staticClass:"c-label"},[e._v("社区名称:")]),e._v(" "),a("span",{staticClass:"c-content"},[e._v(" "+e._s(e.$store.getters.communityName)+" ")])]),e._v(" "),a("li",{staticClass:"c-list"},[a("span",{staticClass:"c-label"},[e._v("住房信息:")]),e._v(" "),a("span",{staticClass:"c-content"},[e._v(" "+e._s(e.data.roomName)+" ")])])])])},staticRenderFns:[]};var i={name:"onePass",data:function(){return{tableData:[],navDetailData:[{id:0,name:"社区物联"},{id:1,name:"一卡通管理"},{id:2,name:"一卡通档案"}],cardList:[{name:"手机蓝牙",id:1},{name:"蓝牙卡",id:2},{name:"IC卡",id:4},{name:"二维码",id:8}],formInline:{keyType:""},pageSize:10,currentPage:1,loading:!1,isShow:!1,total:0,notice:null,see:!1,seeData:null,visible2:!1,delData:null,q_input:null,input:"",show:!1}},components:{AddPage:a("VU/8")(n,s,!1,function(e){a("W/iN")},"data-v-3a879b4e",null).exports,SeePage:a("VU/8")({name:"ChargeSee",data:function(){return{arr:[1,2,4,5]}},props:["msg","data"],created:function(){},methods:{handleClose:function(){this.$emit("upsee",!1)}}},o,!1,function(e){a("zeNb")},"data-v-75dc4bd2",null).exports},methods:{onSubmit:function(){this.show=!0},query:function(){this.q_input=this.input,1!==this.currentPage?this.currentPage=1:this.getTableList(1)},getdataStatus:function(e){return{1:"有效",0:"失效"}[e]},confirmDel:function(){var e=this;this.delData.id&&this.$xttp.get("/community/building/"+this.delData.id+"/delete").then(function(t){t.errorCode||(e.visible2=!1,e.delData=null,e.$message({message:t.data,type:"success"}),e.query())})},change:function(e){1==e?this.isShow=!1:2!=e&&3!=e||(this.isShow=!1)},seeChange:function(e){this.see=!1},changeStatus:function(){this.query()},addChange:function(){this.show=!1},getTableList:function(e){var t=this,a={};a.communityId=this.$store.getters.communityId,this.formInline.keyType?a.keyType=this.formInline.keyType:delete a.keyType,this.q_input&&(a.keyNo=this.q_input),this.loading=!0;var l="user/card/get/list?page="+e+"&size="+this.pageSize;this.$xttp.post(l,a).then(function(e){e.errorCode||(console.log("res",e),t.tableData=e.data.records,t.total=e.data.total,t.tableData.forEach(function(e){e.startDate&&(e.time1=new Date(e.startDate).toISOString().split(".")[0].replace("T"," ")),e.endDate&&(e.time2=new Date(e.endDate).toISOString().split(".")[0].replace("T"," "))})),t.loading=!1}).catch(function(e){t.loading=!1})}},created:function(){this.query()}},r={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-main",[a("div",[a("ul",{staticClass:"c-navDetail clear"},e._l(e.navDetailData,function(t,l){return a("li",{key:l},[e._v(e._s(t.name)+" "),l!==e.navDetailData.length-1?a("span",[e._v(" > ")]):e._e()])})),e._v(" "),a("div",{staticClass:"c-search"},[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.formInline}},[a("el-form-item",[a("el-select",{attrs:{placeholder:"全部卡类型",clearable:""},on:{change:e.changeStatus},model:{value:e.formInline.keyType,callback:function(t){e.$set(e.formInline,"keyType",t)},expression:"formInline.keyType"}},e._l(e.cardList,function(e){return a("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:""}},[a("el-input",{attrs:{placeholder:"卡号"},model:{value:e.input,callback:function(t){e.input=t},expression:"input"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.query}},[a("i",{staticClass:"iconfont icon-sousuo"},[e._v(" ")]),e._v("查询")])],1)],1),e._v(" "),a("el-button",{staticClass:"c-addBtn",attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("新增卡片")])],1)]),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData}},[a("el-table-column",{attrs:{label:"序号",width:"50","show-overflow-tooltip":!0,align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s((e.currentPage-1)*e.pageSize+t.$index+1))]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"卡号","show-overflow-tooltip":!0,width:"130",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.keyNo))]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"卡片类型","show-overflow-tooltip":!0,align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("card")(t.row.keyType)))]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"用户","show-overflow-tooltip":!0,align:"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.name))]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"手机号码","show-overflow-tooltip":!0,align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.phone))]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"住房信息","show-overflow-tooltip":!0,align:"center",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.roomName))]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"有效期","show-overflow-tooltip":!0,align:"center",width:"170"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("time")(t.row.startDate))+" ~ "+e._s(e._f("time")(t.row.endDate)))]}}])})],1),e._v(" "),a("div",{staticClass:"c-block"},[a("el-pagination",{attrs:{"current-page":e.currentPage,"page-size":e.pageSize,layout:"total, prev, pager, next, jumper",total:e.total},on:{"current-change":e.getTableList,"update:currentPage":function(t){e.currentPage=t}}})],1),e._v(" "),a("transition",{attrs:{name:"fade1"}},[e.show?a("AddPage",{attrs:{msg:e.show},on:{change:e.addChange,addSuccess:e.query}}):e._e()],1),e._v(" "),a("transition",{attrs:{name:"fade"}},[e.see?a("SeePage",{attrs:{msg:e.see,data:e.seeData},on:{upsee:e.seeChange}}):e._e()],1)],1)},staticRenderFns:[]};var u=a("VU/8")(i,r,!1,function(e){a("umEh")},"data-v-0cd87e06",null);t.default=u.exports},"W/iN":function(e,t){},umEh:function(e,t){},zeNb:function(e,t){}});
//# sourceMappingURL=16.111444b5c77de6141d32.js.map