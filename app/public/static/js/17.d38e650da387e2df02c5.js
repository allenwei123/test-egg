webpackJsonp([17],{"FUj+":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i("mvHQ"),o=i.n(n),a=i("CzdK"),l={data:function(){return{formVisible:this.visible,communityList:[],file:null,form:{title:"",type:"1",obj:"",body:"",thumbnailUrl:null},text:"新增公告",fileList2:[]}},watch:{visible:function(t){this.formVisible=t},formVisible:function(t){this.$emit("update:visible",t)}},methods:{showInfo:function(t){this.$message({message:t,type:"warning"})},closeForm:function(){this.formVisible=!1},preview:function(){},up:function(){},onExceed:function(){this.$message("只能上传一张图片")},save:function(){var t=this;if(this.form.title.length)if(this.form.body.length){var e=this.$refs.upload.uploadFiles;if(e.length)Object(a.b)(e[0].raw,function(e){t.form.thumbnailUrl=e,t.submitForm()});else{if(0===e.length)return void this.showInfo("图片内容不能为空");this.submitForm()}}else this.showInfo("公告内容不能为空");else this.showInfo("公告标题不能为空")},submitForm:function(){var t=this;this.loading=!0;var e={};e.noticeType=this.form.type,e.communityId=this.$store.getters.communityId,e.title=this.form.title,e.body=this.form.body,this.form.thumbnailUrl&&(e.thumbnailUrl=this.form.thumbnailUrl);var i="property/notice/add";this.isModify&&(i="property/notice/edit",e.id=this.detail.id),this.$xttp.post(i,e).then(function(e){t.loading=!1,0===e.errorCode&&(t.formVisible=!1,t.$emit("saveSuccess"))}).catch(function(){t.loading=!1})}},props:["visible","detail","isModify"],created:function(){var t=this;this.isModify&&(this.text="修改公告",this.form.title=this.detail.title,this.form.type=this.detail.noticeType.toString(),this.form.thumbnailUrl=this.detail.thumbnailUrl,this.form.body=this.detail.body,this.detail.thumbnailUrl&&Object(a.a)(this.detail.thumbnailUrl,function(e){t.fileList2.push({url:e})})),console.log(this.fileList2)}},r={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-dialog",{attrs:{title:t.text,visible:t.formVisible},on:{"update:visible":function(e){t.formVisible=e}}},[i("el-form",{attrs:{model:t.form,"label-width":"120px"}},[i("el-form-item",{attrs:{label:"公告标题","label-width":"120px",required:""}},[i("el-input",{model:{value:t.form.title,callback:function(e){t.$set(t.form,"title","string"==typeof e?e.trim():e)},expression:"form.title"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"公告类型",required:""}},[i("el-select",{attrs:{placeholder:"请选择公告类型"},model:{value:t.form.type,callback:function(e){t.$set(t.form,"type",e)},expression:"form.type"}},[i("el-option",{attrs:{label:"公告",value:"1"}}),t._v(" "),i("el-option",{attrs:{label:"新闻",value:"2"}}),t._v(" "),i("el-option",{attrs:{label:"活动",value:"3"}}),t._v(" "),i("el-option",{attrs:{label:"提醒",value:"4"}}),t._v(" "),i("el-option",{attrs:{label:"其他",value:"99"}})],1)],1),t._v(" "),i("el-form-item",{attrs:{label:"配图",required:""}},[[i("el-upload",{ref:"upload",attrs:{action:"","auto-upload":!1,limit:1,accept:"image/*","on-exceed":t.onExceed,"file-list":t.fileList2,"list-type":"picture-card"}},[i("i",{staticClass:"el-icon-plus"})])]],2),t._v(" "),i("el-form-item",{attrs:{label:"公告内容",required:""}},[i("el-input",{attrs:{type:"textarea",rows:5},model:{value:t.form.body,callback:function(e){t.$set(t.form,"body","string"==typeof e?e.trim():e)},expression:"form.body"}})],1)],1),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:t.closeForm}},[t._v("取消")]),t._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:t.save}},[t._v("保存")])],1)],1)},staticRenderFns:[]};var s={data:function(){return{previewVisible:this.visible,communityName:this.$store.getters.communityName,uri:""}},watch:{visible:function(t){this.previewVisible=t},previewVisible:function(t){this.$emit("update:visible",t)}},props:["visible","noticeInfo"],computed:{time:function(){var t=this.noticeInfo.updateAt;return t||(t=(new Date).getTime()),t}},created:function(){var t=this;this.noticeInfo.thumbnailUrl&&Object(a.a)(this.noticeInfo.thumbnailUrl,function(e){t.uri=e})}},c={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-dialog",{attrs:{title:"公告预览",visible:t.previewVisible},on:{"update:visible":function(e){t.previewVisible=e}}},[t.noticeInfo?i("div",{staticClass:"c-preview-container"},[i("h1",[t._v(t._s(t.noticeInfo.title))]),t._v(" "),t.uri?i("div",{staticClass:"c-image"},[i("img",{attrs:{src:t.uri}})]):t._e(),t._v(" "),i("p",[i("span",[t._v(t._s(t._f("time")(t.time,"yyyy-MM-dd HH:mm")))]),t._v(" "),i("span",{staticStyle:{"margin-left":"20px"}},[t._v(t._s(t.communityName))])]),t._v(" "),i("div",[i("pre",[t._v(t._s(t.noticeInfo.body))])])]):t._e()])},staticRenderFns:[]};var u={name:"notice",components:{NoticeForm:i("VU/8")(l,r,!1,function(t){i("jIhF")},"data-v-0b2373ba",null).exports,NoticePreview:i("VU/8")(s,c,!1,function(t){i("ezbv")},"data-v-bab4cec2",null).exports},data:function(){return{value6:"",value1:"",options:[{value:"0",label:"未发布"},{value:"1",label:"已发布"},{value:"-1",label:"已撤销"}],navDetailData:[{id:0,name:"物业服务"},{id:1,name:"消息管理"},{id:2,name:"社区公告"}],loading:!1,tableData:[],pageSize:10,total:0,currentPage:1,formVisible:!1,formIsModify:!1,formDetail:{},previewVisible:!1,previewNoticeInfo:null,input:"",q_input:null}},methods:{query:function(){this.q_input=this.input,1!==this.currentPage?this.currentPage=1:this.getTableList(1)},changeStatus:function(){this.query(),this.tableData=[]},getNoticeTypeName:function(t){return{1:"公告",2:"新闻",3:"活动",4:"提醒",99:"其他"}[t]},getPublishStatusName:function(t){return{"-1":"已撤销",0:"未发布",1:"已发布"}[t]},publish:function(t){var e=this;this.loading=!0;var i="property/notice/"+t.id+"/publish";this.$xttp.get(i).then(function(i){e.loading=!1,0===i.errorCode&&(t.publishStatus=1)}).catch(function(){e.loading=!1})},del:function(t){var e=this;this.$confirm("确认删除公告？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.loading=!0,e.$xttp.get("property/notice/"+t.id+"/delete").then(function(t){e.loading=!1,0===t.errorCode&&e.getTableList(1)}).catch(function(){e.loading=!1})}).catch(function(){})},modify:function(t){this.formIsModify=!0,this.formDetail=t,this.formVisible=!0},addNotice:function(){this.formIsModify=!1,this.formVisible=!0},preview:function(t){this.previewNoticeInfo=t,this.previewVisible=!0},deepCopy:function(t){return JSON.parse(o()(t))},push:function(t){var e=this;this.$confirm("确认推送此公告吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.loading=!0,e.$xttp.get("property/notice/"+t.id+"/push").then(function(t){e.loading=!1,0===t.errorCode&&e.getTableList(1)}).catch(function(){e.loading=!1})})},revoke:function(t){var e=this;this.loading=!0;var i={id:t.id,publishStatus:-1,body:t.body};this.$xttp.post("property/notice/edit",i).then(function(i){e.loading=!1,0===i.errorCode&&(e.tableData=e.tableData.map(function(e){return e===t&&(e=i.data),e}))}).catch(function(){e.loading=!1})},getTableList:function(t){var e=this;this.loading=!0;var i="property/notice/page?page="+t+"&size="+this.pageSize,n={};if(n.communityId=this.$store.getters.communityId,this.value1&&(n.publishStatus=this.value1),this.value6){var o=new Date(this.value6[0]),a=new Date(this.value6[1]);n.startAt=o.getFullYear()+"-"+(o.getMonth()<10?"0":"")+(o.getMonth()+1)+"-"+(o.getDate()<10?"0":"")+o.getDate(),n.endAt=a.getFullYear()+"-"+(a.getMonth()<10?"0":"")+(a.getMonth()+1)+"-"+(a.getDate()<10?"0":"")+a.getDate()}this.$xttp.post(i,n).then(function(t){e.loading=!1,0===t.errorCode&&(e.tableData=t.data.records,e.total=t.data.total)}).catch(function(){e.loading=!1})}},created:function(){this.query()}},f={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-container",[i("el-main",[i("ul",{staticClass:"c-navDetail clear"},t._l(t.navDetailData,function(e,n){return i("li",{key:n},[t._v(t._s(e.name)+" "),n!==t.navDetailData.length-1?i("span",[t._v(" > ")]):t._e()])})),t._v(" "),i("div",{staticClass:"c-notice-container"},[i("div",{staticClass:"c-search"},[i("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0}},[i("el-select",{attrs:{placeholder:"全部状态",clearable:""},on:{change:t.changeStatus},model:{value:t.value1,callback:function(e){t.value1=e},expression:"value1"}},t._l(t.options,function(t){return i("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),t._v(" "),i("el-date-picker",{attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",clearable:""},on:{change:t.changeStatus},model:{value:t.value6,callback:function(e){t.value6=e},expression:"value6"}}),t._v(" "),i("el-form-item",[i("el-button",{attrs:{type:"primary"},on:{click:t.query}},[t._v("查询")])],1),t._v(" "),i("el-form-item",{staticStyle:{float:"right"}},[i("el-button",{staticClass:"c-addBtn",attrs:{type:"primary"},on:{click:t.addNotice}},[t._v("新增公告")])],1)],1)],1),t._v(" "),i("div",{staticClass:"c-list"},[i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.tableData,stripe:""}},[i("el-table-column",{attrs:{label:"序号",width:"80","show-overflow-tooltip":!0,align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s((t.currentPage-1)*t.pageSize+e.$index+1))]}}])}),t._v(" "),i("el-table-column",{attrs:{label:"标题","min-width":"180","show-overflow-tooltip":!0,align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.title))]}}])}),t._v(" "),i("el-table-column",{attrs:{label:"类型","min-width":"60","show-overflow-tooltip":!0,align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t.getNoticeTypeName(e.row.noticeType)))]}}])}),t._v(" "),i("el-table-column",{attrs:{label:"发布对象",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.editorName))]}}])}),t._v(" "),i("el-table-column",{attrs:{label:"状态","min-width":"100","show-overflow-tooltip":!0,align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t.getPublishStatusName(e.row.publishStatus)))]}}])}),t._v(" "),i("el-table-column",{attrs:{label:"发布时间","min-width":"160","show-overflow-tooltip":!0,align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("time")(e.row.updateAt,"yyyy-MM-dd HH:mm")))]}}])}),t._v(" "),i("el-table-column",{attrs:{label:"操作",width:"300",fixed:t.tableData.length?"right":"/",align:"left"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(i){t.preview(e.row)}}},[t._v("预览")]),t._v(" "),1===e.row.publishStatus?[0===e.row.pushStatus?i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(i){t.push(e.row)}}},[t._v("推送")]):t._e(),t._v(" "),i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(i){t.revoke(e.row)}}},[t._v("撤销")])]:t._e(),t._v(" "),1!==e.row.publishStatus?[i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(i){t.publish(e.row)}}},[t._v("发布")]),t._v(" "),i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(i){t.modify(e.row)}}},[t._v("修改")]),t._v(" "),i("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(i){t.del(e.row)}}},[t._v("删除")])]:t._e()]}}])})],1)],1),t._v(" "),i("div",{staticClass:"c-pagination"},[i("el-pagination",{attrs:{layout:"total, prev, pager, next, jumper",total:t.total,"page-size":t.pageSize,"current-page":t.currentPage},on:{"current-change":t.getTableList,"update:currentPage":function(e){t.currentPage=e}}})],1)]),t._v(" "),t.formVisible?i("NoticeForm",{attrs:{detail:t.formDetail,isModify:t.formIsModify,visible:t.formVisible},on:{"update:visible":function(e){t.formVisible=e},saveSuccess:t.query}}):t._e(),t._v(" "),t.previewVisible?i("NoticePreview",{attrs:{visible:t.previewVisible,noticeInfo:t.previewNoticeInfo},on:{"update:visible":function(e){t.previewVisible=e}}}):t._e()],1)],1)},staticRenderFns:[]};var d=i("VU/8")(u,f,!1,function(t){i("cE9j")},"data-v-3eba5445",null);e.default=d.exports},cE9j:function(t,e){},ezbv:function(t,e){},jIhF:function(t,e){}});
//# sourceMappingURL=17.d38e650da387e2df02c5.js.map