webpackJsonp([21],{LuDC:function(t,e){},SyW9:function(t,e){},"lJ/k":function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o("mvHQ"),n=o.n(i),s=o("CzdK"),l={data:function(){return{formVisible:!0,communityList:[],file:null,isSee:!1,isShow:!0,form:{href:"",photo:null,communityId:"",rank:"1",gotoType:1,shopId:""},fileList2:[],title:"新增轮播图",shopList:[]}},watch:{visible:function(t){this.formVisible=t},formVisible:function(t){this.$emit("update:visible",t)}},methods:{showInfo:function(t){this.$message({message:t,type:"warning"})},closeForm:function(){this.formVisible=!1},onExceed:function(){this.$message("只能上传一张图片")},changCommunity:function(){this.form.shopId="",this.shop()},changeGotoType:function(){console.log(this.form.gotoType),1==this.form.gotoType&&(this.isSee=!1,this.isShow=!0,this.shop(),this.form.href=""),2==this.form.gotoType&&(this.isSee=!0,this.isShow=!1,this.form.shopId="")},community:function(){var t=this;this.loading=!0;this.$xttp.get("community/page").then(function(e){e.errorCode||(t.loading=!1,t.communityList=e.data.records,e.data.records.length>0&&(t.isModify||(t.form.communityId=e.data.records[0].id)))}).catch(function(){t.loading=!1})},shop:function(){var t=this;this.loading=!0;var e={};e.communityId=this.form.communityId,console.log(e),this.$xttp.post("/biz/shop/list",e).then(function(e){e.success&&(console.log(e),t.loading=!1,t.shopList=e.data,e.data.length>0&&(t.isModify||(t.form.shopId=e.data[0].id)))})},save:function(){var t=this;if(2!=this.form.gotoType||""!=this.form.href)if(1!=this.form.gotoType||""!=this.form.shopId)if(this.isModify){var e=this.$refs.upload.uploadFiles;if(!e.length)return this.showInfo("轮播图不能为空"),this.form.photo="",void(this.detail.photo="");this.detail.photo==this.form.photo&&""!=this.detail.photo?(this.form.photo=this.detail.photo,this.submitForm()):Object(s.b)(e[0].raw,function(e){t.detail.photo="",t.form.photo=e,t.submitForm()})}else{var o=this.$refs.upload.uploadFiles;if(o.length)Object(s.b)(o[0].raw,function(e){t.form.photo=e,t.submitForm()});else{if(0===o.length)return void this.showInfo("请上传图片");this.submitForm()}}else this.showInfo("请选择跳转商家");else this.showInfo("请输入跳转链接")},submitForm:function(){var t=this;this.loading=!0;var e={};e.rank=this.form.rank,e.communityId=this.form.communityId,e.gotoType=this.form.gotoType,1==this.form.gotoType?(e.shopId=this.form.shopId,e.href&&delete e.href):(e.href=this.form.href,e.shopId&&delete e.shopId),e.photo=this.form.photo;var o="biz/slide/add";this.isModify&&(o="biz/slide/edit",e.id=this.detail.id),console.log(e),console.log(o),this.$xttp.post(o,e).then(function(o){t.loading=!1,console.log(e),0===o.errorCode&&(console.log(o),t.formVisible=!1,t.isModify?t.$message({message:"修改成功",type:"success"}):t.$message({message:"新增成功",type:"success"}),t.$emit("saveSuccess"))}).catch(function(){t.loading=!1})}},props:["visible","detail","isModify"],created:function(){var t=this;this.community(),this.isModify?(this.title="修改轮播图",console.log(this.detail),this.detail.photo&&(Object(s.a)(this.detail.photo,function(e){t.fileList2.push({url:e})}),this.form.photo=this.detail.photo),this.form.rank=this.detail.rank,this.form.communityId=this.detail.communityId,console.log(this.detail.gotoType),this.form.gotoType=this.detail.gotoType,console.log(this.form.gotoType),null!=this.detail.href?(this.isSee=!0,this.form.href=this.detail.href,this.isShow=!1):(this.isSee=!1,this.isShow=!0,this.shop(),this.form.shopId=this.detail.shopId)):this.shop()}},a={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{attrs:{title:t.title,visible:t.formVisible},on:{"update:visible":function(e){t.formVisible=e}}},[o("el-form",{attrs:{model:t.form,"label-width":"120px"}},[o("el-form-item",{staticClass:"c-must",attrs:{label:"轮播图："}},[[o("el-upload",{ref:"upload",attrs:{action:"","auto-upload":!1,limit:1,accept:"image/*","on-exceed":t.onExceed,"file-list":t.fileList2,"list-type":"picture-card"}},[o("i",{staticClass:"el-icon-plus"})])]],2),t._v(" "),o("el-form-item",{staticClass:"c-must",attrs:{label:"所属社区：","label-width":"120px",prop:"communityId"}},[o("el-select",{on:{change:t.changCommunity},model:{value:t.form.communityId,callback:function(e){t.$set(t.form,"communityId",e)},expression:"form.communityId"}},t._l(t.communityList,function(t){return o("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}))],1),t._v(" "),o("el-form-item",{staticClass:"c-must",attrs:{label:"播放顺序："}},[o("el-select",{attrs:{placeholder:"请选择播放顺序"},model:{value:t.form.rank,callback:function(e){t.$set(t.form,"rank",e)},expression:"form.rank"}},[o("el-option",{attrs:{label:"1",value:"1"}}),t._v(" "),o("el-option",{attrs:{label:"2",value:"2"}}),t._v(" "),o("el-option",{attrs:{label:"3",value:"3"}})],1)],1),t._v(" "),o("el-form-item",{staticClass:"c-must",attrs:{label:"跳转类型：","label-width":"120px"}},[o("el-radio",{attrs:{label:1},on:{change:function(e){t.changeGotoType()}},model:{value:t.form.gotoType,callback:function(e){t.$set(t.form,"gotoType",e)},expression:"form.gotoType"}},[t._v("商家")]),t._v(" "),o("el-radio",{attrs:{label:2},on:{change:function(e){t.changeGotoType()}},model:{value:t.form.gotoType,callback:function(e){t.$set(t.form,"gotoType",e)},expression:"form.gotoType"}},[t._v("第三方")])],1),t._v(" "),t.isShow?o("el-form-item",{staticClass:"c-must",attrs:{label:"跳转商家：","label-width":"120px",prop:"shopId"}},[o("el-select",{model:{value:t.form.shopId,callback:function(e){t.$set(t.form,"shopId",e)},expression:"form.shopId"}},t._l(t.shopList,function(t){return o("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}))],1):t._e(),t._v(" "),t.isSee?o("el-form-item",{staticClass:"c-must",attrs:{label:"跳转链接：",prop:"href"}},[o("el-col",{attrs:{span:14}},[o("el-input",{attrs:{placeholder:"请输入跳转链接"},model:{value:t.form.href,callback:function(e){t.$set(t.form,"href","string"==typeof e?e.trim():e)},expression:"form.href"}})],1)],1):t._e()],1),t._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:t.closeForm}},[t._v("取消")]),t._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:t.save}},[t._v("保存")])],1)],1)},staticRenderFns:[]};var r={name:"slideShow",components:{NoticeForm:o("VU/8")(l,a,!1,function(t){o("LuDC")},"data-v-f83105d0",null).exports},data:function(){return{navDetailData:[{id:0,name:"商圈管理"},{id:1,name:"周边商圈"},{id:2,name:"轮播图管理"}],loading:!1,isShow:!1,tableData:[],pageSize:10,total:0,currentPage:1,formVisible:!1,formIsModify:!1,formDetail:{},previewVisible:!1,previewNoticeInfo:null,input:"",q_input:null,uri:"",temp:"",isEdit:!1,notice:null}},methods:{handlegetTableList:function(t){this.temp=t,this.getTableList(this.temp)},editChange:function(t){this.isEdit=!1},query:function(){this.q_input=this.input,1!==this.currentPage?this.currentPage=1:this.getTableList(1)},gotoType:function(t){return{1:"本地商店",2:"外来链接"}[t]},dataStatusFilter:function(t){return{0:"无效",1:"有效"}[t]},getNoticeTypeName:function(t){return{1:"公告",2:"新闻",3:"活动",4:"提醒",99:"其他"}[t]},getPublishStatusName:function(t){return{"-1":"已撤销",0:"未发布",1:"已发布"}[t]},publish:function(t){var e=this;this.$confirm("确定发布轮播图?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.loading=!0;var o="biz/slide/"+t.id+"/publish";e.$xttp.get(o).then(function(o){e.loading=!1,0===o.errorCode&&(t.published=1)}).catch(function(){e.loading=!1})}).catch(function(t){console.log(t)})},del:function(t){var e=this;this.$confirm("确认删除轮播图？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.loading=!0,e.$xttp.get("biz/slide/"+t.id+"/delete").then(function(t){e.loading=!1,0===t.errorCode&&e.getTableList(e.temp)}).catch(function(){e.loading=!1})}).catch(function(){})},modify:function(t){this.formIsModify=!0,this.formDetail=t,this.formVisible=!0},saveSuccess:function(){this.getTableList(this.temp)},addNotice:function(){this.formIsModify=!1,this.formVisible=!0},preview:function(t){this.previewNoticeInfo=t,this.previewVisible=!0},deepCopy:function(t){return JSON.parse(n()(t))},push:function(t){var e=this;this.$confirm("确认推送此公告吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.loading=!0,e.$xttp.get("property/notice/"+t.id+"/push").then(function(t){e.loading=!1,0===t.errorCode&&e.getTableList(e.temp)}).catch(function(){e.loading=!1})})},revoke:function(t){var e=this;this.$confirm("确定撤销发布?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.loading=!0;var o=t.id;e.$xttp.get("biz/slide/"+o+"/revoke").then(function(o){e.loading=!1,0===o.errorCode&&(e.getTableList(e.temp),t.published=-1)}).catch(function(){e.loading=!1})}).catch(function(t){console.log(t)})},getTableList:function(t){var e=this;this.loading=!0;var o="biz/slide/page?page="+t+"&size="+this.pageSize,i={};i.communityId=this.$store.getters.communityId,this.q_input&&(i.shopName=this.q_input),this.$xttp.post(o,i).then(function(t){e.loading=!1,0===t.errorCode&&(e.tableData=t.data.records,e.total=t.data.total,e.tableData.forEach(function(t){Object(s.a)(t.photo,function(e){t.url=e})}))}).catch(function(){e.loading=!1})}},created:function(){this.query()}},c={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-container",[o("el-main",[o("ul",{staticClass:"c-navDetail clear"},t._l(t.navDetailData,function(e,i){return o("li",{key:i},[t._v(t._s(e.name)+" "),i!==t.navDetailData.length-1?o("span",[t._v(" > ")]):t._e()])})),t._v(" "),o("div",{staticClass:"c-notice-container"},[o("div",{staticClass:"c-searchbar"},[o("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0}},[o("el-form-item",{attrs:{label:""}},[o("el-input",{attrs:{placeholder:"商户名称"},model:{value:t.input,callback:function(e){t.input="string"==typeof e?e.trim():e},expression:"input"}})],1),t._v(" "),o("el-form-item",[o("el-button",{attrs:{type:"primary"},on:{click:t.query}},[t._v("查询")])],1),t._v(" "),o("el-form-item",{staticStyle:{float:"right"}},[o("el-button",{attrs:{type:"primary"},on:{click:t.addNotice}},[t._v("新增轮播图")])],1)],1)],1),t._v(" "),o("div",{staticClass:"c-list"},[o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.tableData,stripe:""}},[o("el-table-column",{attrs:{label:"序号",width:"60","show-overflow-tooltip":!0,align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s((t.currentPage-1)*t.pageSize+e.$index+1))]}}])}),t._v(" "),o("el-table-column",{attrs:{label:"轮播图","min-width":"200",align:"center","show-overflow-tooltip":!0},scopedSlots:t._u([{key:"default",fn:function(t){return[o("el-button",{attrs:{type:"text"}},[o("img",{attrs:{width:"60px",height:"60px",src:t.row.url}})])]}}])}),t._v(" "),o("el-table-column",{attrs:{label:"关联社区","min-width":"180","show-overflow-tooltip":!0,align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.communityName))]}}])}),t._v(" "),o("el-table-column",{attrs:{label:"播放顺序","min-width":"100","show-overflow-tooltip":!0,align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.rank))]}}])}),t._v(" "),o("el-table-column",{attrs:{label:"跳转类型","min-width":"120","show-overflow-tooltip":!0,align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t.gotoType(e.row.gotoType)))]}}])}),t._v(" "),o("el-table-column",{attrs:{label:"关联商家","min-width":"100","show-overflow-tooltip":!0,align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.shopName))]}}])}),t._v(" "),o("el-table-column",{attrs:{label:"链接地址","min-width":"100","show-overflow-tooltip":!0,align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.href))]}}])}),t._v(" "),o("el-table-column",{attrs:{label:"状态","min-width":"160","show-overflow-tooltip":!0,align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t.getPublishStatusName(e.row.published)))]}}])}),t._v(" "),o("el-table-column",{attrs:{label:"操作",width:"300",fixed:t.tableData.length?"right":"/",align:"left"},scopedSlots:t._u([{key:"default",fn:function(e){return[1===e.row.published?[0===e.row.published?o("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(o){t.push(e.row)}}},[t._v("推送")]):t._e(),t._v(" "),o("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(o){t.revoke(e.row)}}},[t._v("撤销")])]:t._e(),t._v(" "),1!==e.row.published?[o("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(o){t.publish(e.row)}}},[t._v("发布")]),t._v(" "),o("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(o){t.del(e.row)}}},[t._v("删除")])]:t._e()]}}])})],1)],1),t._v(" "),o("div",{staticClass:"c-pagination"},[o("el-pagination",{attrs:{layout:"total, prev, pager, next, jumper",total:t.total,"page-size":t.pageSize,"current-page":t.currentPage},on:{"current-change":t.handlegetTableList,"update:currentPage":function(e){t.currentPage=e}}})],1)]),t._v(" "),t.formVisible?o("NoticeForm",{attrs:{detail:t.formDetail,isModify:t.formIsModify,visible:t.formVisible},on:{"update:visible":function(e){t.formVisible=e},saveSuccess:t.saveSuccess}}):t._e()],1)],1)},staticRenderFns:[]};var u=o("VU/8")(r,c,!1,function(t){o("SyW9")},"data-v-6be83bce",null);e.default=u.exports}});
//# sourceMappingURL=21.1bcb8820eb926ea27a3a.js.map